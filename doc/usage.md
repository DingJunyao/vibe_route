# 使用指南

本文档详细介绍 Vibe Route 轨迹管理系统的各项功能使用方法。

## 目录

- [用户注册与登录](#用户注册与登录)
- [首页概览](#首页概览)
- [轨迹上传](#轨迹上传)
- [轨迹管理](#轨迹管理)
- [轨迹详情](#轨迹详情)
- [实时记录](#实时记录)
- [后台管理](#后台管理)
- [道路标志生成](#道路标志生成)
- [覆盖层生成](#覆盖层生成)

---

## 用户注册与登录

### 注册账户

<!-- 占位符: 注册页面截图 -->

1. 访问系统首页，点击右上角"注册"按钮
2. 填写注册信息：
   - **用户名**：3-20 个字符，只能包含字母、数字、下划线
   - **邮箱**：有效的邮箱地址
   - **密码**：至少 8 个字符
3. 如果系统启用了邀请码，需要输入有效的邀请码
4. 点击"注册"按钮完成注册

> **注意**：系统首位注册的用户将自动成为管理员。

### 登录系统

<!-- 占位符: 登录页面截图 -->

1. 访问系统首页，点击右上角"登录"按钮
2. 输入用户名或邮箱和密码
3. 点击"登录"按钮

### 找回密码

如果忘记密码，请联系管理员重置密码。

---

## 首页概览

登录后，首页显示以下内容：

### 统计卡片

<!-- 占位符: 首页统计卡片截图 -->

首页顶部显示四个统计卡片：

- **轨迹数量**：已上传的轨迹总数
- **总距离**：所有轨迹的总里程
- **总时长**：所有轨迹的总历时
- **总爬升**：所有轨迹的总爬升高度

### 地图预览

<!-- 占位符: 首页地图截图 -->

首页中央显示地图，展示所有轨迹：

- **悬停轨迹**：显示轨迹名称、时间、里程、历时
- **点击轨迹**：跳转到轨迹详情页
- **居中按钮**：点击地图控制栏的居中按钮，自动调整视野以显示所有轨迹

### 底图切换

点击地图右上角的底图切换按钮，可选择不同的地图提供商：

- **高德地图**
- **百度地图**
- **腾讯地图**
- **OpenStreetMap**

---

## 轨迹上传

### 支持的文件格式

| 格式 | 说明 | 兼容性 |
|------|------|--------|
| GPX | 标准 GPS 交换格式 | 推荐 |
| CSV | 逗号分隔值，支持 GPS Logger 格式 | 需指定格式 |
| XLSX | Excel 表格格式 | 需指定格式 |
| KML | Google Earth 格式 | 支持 |
| KMZ | KML 压缩格式 | 支持 |

### 上传步骤

<!-- 占位符: 轨迹上传页面截图 -->

1. 点击顶部导航栏的"上传轨迹"按钮
2. 填写轨迹信息：
   - **轨迹名称**（必填）
   - **描述**（可选）
3. 选择文件格式：
   - **自动检测**：系统自动识别格式
   - **手动指定**：从下拉菜单选择格式
4. 选择原始坐标系：
   - **WGS84**：GPS 原始坐标，推荐
   - **GCJ02**：中国火星坐标系
   - **BD09**：百度坐标系
5. 点击"选择文件"按钮，选择要上传的文件
6. 点击"上传"按钮

### CSV/XLSX 格式说明

#### GPS Logger CSV 格式

标准 GPS Logger 应用导出的 CSV 格式：

```csv
lat,lon,alt,time,date,spd
39.9042,116.4074,50,12:30:45,2024-01-01,5.2
```

#### 自定义 CSV/XLSX 格式

如果使用自定义格式，需要指定列名映射：

| 系统字段 | 可选列名 |
|----------|----------|
| 纬度 | lat, latitude, 纬度 |
| 经度 | lon, lng, longitude, 经度 |
| 海拔 | alt, altitude, ele, elevation, 海拔 |
| 时间 | time, time_time, 时间 |
| 日期 | date, time_date, 日期 |
| 速度 | spd, speed, 速度 |

### 上传后处理

上传完成后，系统会自动：

1. 解析轨迹点数据
2. 进行坐标系转换
3. 填充地理编码信息（行政区划、道路）
4. 计算统计信息（距离、时长、爬升）

对于大文件，系统使用异步任务处理，可以在任务列表查看进度。

---

## 轨迹管理

### 轨迹列表

<!-- 占位符: 轨迹列表页面截图 -->

轨迹列表页面显示所有已上传的轨迹，支持以下操作：

#### 搜索

在搜索框中输入轨迹名称，系统会实时过滤显示结果。

#### 排序

点击排序按钮，可按以下方式排序：

- **开始时间**：最新或最旧
- **距离**：最长或最短
- **时长**：最长或最短

#### 筛选

点击筛选按钮，可按以下条件筛选：

- **轨迹类型**：普通轨迹 / 实时记录
- **记录状态**：进行中 / 已完成

#### 查看轨迹

点击轨迹卡片或列表项，进入轨迹详情页。

#### 编辑轨迹

点击轨迹卡片上的"编辑"按钮，可修改：

- 轨迹名称
- 描述
- 原始坐标系

修改坐标系后，系统会重新计算其他坐标系的坐标。

#### 删除轨迹

点击轨迹卡片上的"删除"按钮，确认后删除轨迹。

> **注意**：删除操作不可恢复，请谨慎操作。

### 轨迹导出

在轨迹详情页，点击"导出数据"按钮，可选择以下格式导出：

#### GPX 格式

- 标准的 GPS 交换格式
- 支持选择导出坐标系
- 兼容大多数 GPS 设备和软件

#### CSV 格式

- UTF-8 编码带 BOM
- 确保 Excel 正确显示中文
- 包含所有轨迹点信息

#### XLSX 格式

- Excel 表格格式
- 本系统特有格式
- 包含所有轨迹点信息

#### KML 格式

- Google Earth 格式
- 使用 Google gx:Track 扩展
- 支持导入两步路等应用

### 数据导入

在轨迹详情页，点击"导入数据"按钮，可导入外部数据补充轨迹信息：

#### 支持的格式

- CSV
- XLSX

#### 导入内容

- 行政区划信息（省、市、区）
- 道路信息（道路编号、道路名称）

#### 匹配方式

- **索引匹配**：按轨迹点索引匹配
- **时间匹配**：按时间戳匹配

导入过程使用异步任务处理，可以在任务列表查看进度。

---

## 轨迹详情

### 页面布局

<!-- 占位符: 轨迹详情页面截图（桌面端） -->

<!-- 占位符: 轨迹详情页面截图（移动端） -->

轨迹详情页包含以下区域：

#### 顶部信息栏

- 轨迹名称
- 实时记录状态（如果是实时记录）
- 操作按钮：编辑、导入数据、导出数据、删除

#### 地图区域

- 显示轨迹路径
- 悬停/点击轨迹点显示详细信息
- 经过区域高亮
- 底图切换
- 居中按钮

#### 图表区域

- **海拔剖面图**：显示海拔变化趋势
- **速度曲线图**：显示速度变化趋势

鼠标悬停在图表上时，地图上对应点会高亮显示。

#### 经过区域

树形结构显示轨迹经过的行政区划和道路：

- **省**：点击高亮该省内所有轨迹段
- **市**：点击高亮该市内所有轨迹段
- **区**：点击高亮该区内所有轨迹段
- **道路**：点击高亮该道路上所有轨迹段，并显示道路标志

#### 统计信息

- **距离**：轨迹总里程
- **时长**：轨迹总历时
- **爬升**：总爬升高度
- **平均速度**：平均移动速度
- **最高点**：轨迹最高海拔
- **最低点**：轨迹最低海拔

#### 轨迹点列表

显示所有轨迹点的详细信息：

- 序号
- 时间
- 坐标（三种坐标系）
- 海拔
- 速度

### 地图交互

#### 桌面端

- **悬停轨迹点**：显示点信息提示框
- **悬停图表**：地图同步高亮对应点

#### 移动端

- **点击轨迹点**：显示点信息提示框
- **点击图表**：地图同步高亮对应点

### 经过区域高亮

点击"经过区域"树中的任何项目，地图上对应的路径段会显示为蓝色高亮。

道路项目会同时显示对应的道路标志（如 G221、豫S88 等）。

---

## 实时记录

### 创建实时记录会话

<!-- 占位符: 实时记录配置页面截图 -->

1. 点击顶部导航栏的"记录实时轨迹"按钮
2. 填写会话信息：
   - **轨迹名称**（必填）
   - **描述**（可选）
3. 点击"创建"按钮

系统会生成一个上传 URL 和 Token。

### 配置 GPS Logger

使用 GPS Logger 等应用配置上传 URL：

```
https://your-domain.com/api/live-recordings/log/{TOKEN}?lat=%LAT&lon=%LON&time=%TIME&alt=%ALT&spd=%SPD
```

#### GPS Logger 配置示例

<!-- 占位符: GPS Logger 配置截图 -->

1. 打开 GPS Logger 应用
2. 进入设置 → 日志记录
3. 找到"自定义 URL"或"HTTP 请求"
4. 启用自定义 URL
5. 填入系统生成的上传 URL
6. 启动日志记录

### 实时查看

创建实时记录后，系统会自动打开轨迹详情页：

- 地图实时显示新添加的轨迹点
- 统计信息自动更新
- 顶部显示实时记录状态

- 🔴 **红色闪动** - 实时轨迹记录中
- 🟡 **黄色** - 连接断开/有故障

### 结束实时记录

1. 打开实时记录会话对话框
2. 点击"结束记录"按钮
3. 确认操作

结束后，轨迹会转换为普通轨迹，不再接收新数据。

### 删除实时记录

1. 打开实时记录会话对话框
2. 点击"删除"按钮
3. 确认操作

> **注意**：删除实时记录会同时删除关联的轨迹数据。

---

## 后台管理

> **注意**：后台管理功能仅对管理员用户开放。

### 用户管理

<!-- 占位符: 用户管理页面截图 -->

#### 用户列表

显示所有已注册用户，包括：

- 用户名
- 邮箱
- 角色（管理员/普通用户）
- 状态（启用/禁用）
- 注册时间
- 最后登录时间

#### 搜索与筛选

- **搜索**：按用户名或邮箱搜索
- **角色筛选**：全部/管理员/普通用户
- **状态筛选**：全部/启用/禁用

#### 用户操作

- **设置管理员**：授予或取消管理员权限
- **禁用/启用**：禁用或启用用户账户
- **重置密码**：重置用户密码为默认值
- **删除**：删除用户（软删除）

> **限制**：不能操作自己的账户，不能删除首位用户。

### 系统配置

<!-- 占位符: 系统配置页面截图 -->

#### 注册设置

- **允许注册**：开启/关闭用户注册功能
- **需要邀请码**：注册时是否需要邀请码

#### 地图配置

- **默认地图提供商**：选择默认地图
- **地图层配置**：配置各地图的图层

#### 字体配置

- **道路标志字体**：设置 A/B/C 类型的激活字体

### 邀请码管理

<!-- 占位符: 邀请码管理页面截图 -->

#### 创建邀请码

1. 点击"创建邀请码"按钮
2. 设置邀请码参数：
   - **使用次数**：最多可使用次数
   - **有效期**：邀请码过期时间
3. 点击"创建"按钮

系统会生成一个随机邀请码。

#### 邀请码列表

显示所有邀请码及其状态：

- 邀请码
- 使用次数 / 最大次数
- 创建时间
- 过期时间
- 状态

#### 删除邀请码

点击邀请码的"删除"按钮，确认后删除。

---

## 道路标志生成

### 功能说明

道路标志生成工具可以创建符合中国标准的道路标志 SVG 图片。

<!-- 占位符: 道路标志生成页面截图 -->

### 道路类型

#### 普通道路

- **国道**：G + 三位数字（如 G221）
- **省道**：S + 三位数字（如 S221）
- **县道**：X + 三位数字（如 X221）

#### 高速公路

- **国家高速**：G + 1-4 位数字（如 G5、G1234）
- **省级高速**：
  - S + 纯数字（如 S88）
  - S + 字母 + 可选数字（仅限四川省，如 SA、SB、SC）

### 生成步骤

1. 选择道路类型：普通道路 / 高速公路
2. 输入道路编号：
   - 普通道路：如 `G221`、`豫S221`
   - 高速公路：如 `G5`、`豫S88`
3. 点击"生成"按钮
4. 预览生成的标志
5. 点击"下载 SVG"按钮保存

### 省份前缀

省级道路可使用省份前缀：

| 省份 | 前缀 | 省份 | 前缀 |
|------|------|------|------|
| 北京 | 京 | 天津 | 津 |
| 河北 | 冀 | 山西 | 晋 |
| 内蒙古 | 蒙 | 辽宁 | 辽 |
| 吉林 | 吉 | 黑龙江 | 黑 |
| 上海 | 沪 | 江苏 | 苏 |
| 浙江 | 浙 | 安徽 | 皖 |
| 福建 | 闽 | 江西 | 赣 |
| 山东 | 鲁 | 河南 | 豫 |
| 湖北 | 鄂 | 湖南 | 湘 |
| 广东 | 粤 | 广西 | 桂 |
| 海南 | 琼 | 重庆 | 渝 |
| 四川 | 川 | 贵州 | 贵 |
| 云南 | 云 | 西藏 | 藏 |
| 陕西 | 陕 | 甘肃 | 甘 |
| 青海 | 青 | 宁夏 | 宁 |
| 新疆 | 新 | | |

---

## 覆盖层生成

### 功能说明

覆盖层生成工具可以创建带有轨迹信息的图片序列，用于视频制作等用途。

<!-- 占位符: 覆盖层生成页面截图 -->

### 配置选项

#### 图片设置

- **宽度**：输出图片宽度（像素）
- **高度**：输出图片高度（像素）
- **字体大小**：文字大小

#### 显示内容

可选择显示以下信息：

- 坐标（经纬度）
- 海拔
- 时间
- 速度
- 道路信息

### 生成步骤

1. 选择要生成覆盖层的轨迹
2. 配置图片尺寸和字体大小
3. 选择要显示的内容
4. 点击"生成"按钮
5. 等待异步任务完成
6. 下载生成的 ZIP 文件

### 输出格式

生成的 ZIP 文件包含：

- 一系列 PNG 图片，按轨迹点顺序命名
- 每张图片对应一个轨迹点，显示配置的信息

---

## 快捷操作

### 键盘快捷键

| 快捷键 | 功能 |
|--------|------|
| `Esc` | 关闭对话框 |
| `Enter` | 确认表单提交 |

### 移动端手势

| 手势 | 功能 |
|------|------|
| 点击 | 选择/确认 |
| 长按 | 显示更多信息 |
| 滑动 | 滚动列表/页面 |

---

## 常见问题

### Q: 上传的轨迹显示不正确？

A: 检查以下几点：

1. 确认选择的原始坐标系正确
2. 检查文件格式是否符合要求
3. 查看错误信息了解具体问题

### Q: 地图不显示轨迹？

A: 可能的原因：

1. 底图加载失败，尝试切换底图
2. 网络连接问题
3. 浏览器兼容性问题，推荐使用 Chrome 或 Firefox

### Q: 实时记录不更新？

A: 检查以下几点：

1. GPS Logger 配置的 URL 是否正确
2. Token 是否有效
3. 设备网络连接是否正常

### Q: 如何联系管理员？

A: 如果您忘记了密码或需要其他帮助，请联系系统管理员。

---

## 附录

### 文件大小限制

- GPX 文件：最大 100 MB
- CSV/XLSX 文件：最大 50 MB
- KML/KMZ 文件：最大 100 MB

### 支持的浏览器

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

### 移动端支持

- iOS Safari 14+
- Android Chrome 90+
