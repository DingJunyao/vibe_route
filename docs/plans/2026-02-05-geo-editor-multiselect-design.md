# 地理信息编辑器：多选与批量操作设计

**日期**: 2026-02-05
**状态**: 已验证
**优先级**: 高

## 概述

为地理信息编辑器的轨道时间轴添加多选和批量操作功能，参考视频编辑软件的交互模式。

## 功能需求

### 1. 多选功能

| 操作 | 行为 |
|------|------|
| 单击 | 选中该块，取消其他选择 |
| Ctrl/Shift + 单击 | 切换选中状态（添加/移除） |
| 点击轨道行空白区域 | 取消所有选择 |
| Esc 键 | 取消所有选择 |

### 2. 批量操作

| 操作 | 触发方式 | 行为 |
|------|---------|------|
| 批量清空 | 按钮 / Delete 键 | 将选中块内容设为 null |
| 批量合并 | 按钮 | 合并同一轨道内连续选中的块 |

### 3. 合并规则

- 每个轨道独立处理
- 仅合并**连续**选中的块（`当前段.startIndex = 上一段.endIndex + 1`）
- 如果选中的都是空块 → 合并为大空块
- 如果选中既有空又有非空 → 以第一个非空块的值为准
- 合并后自动清理无效 ID

### 4. 视觉反馈

- 控制栏显示选中数量："已选择 3 个块"
- 选中块：蓝色背景 + 可选的选中角标（✓）
- 合并按钮：无可合并块时禁用
- 地图：显示所有选中块的高亮

## 数据模型变更

```typescript
// stores/geoEditor.ts

// 之前
const selectedSegmentId = ref<string | null>(null)

// 之后
const selectedSegmentIds = ref<Set<string>>(new Set())
```

## 文件变更清单

| 文件 | 变更内容 |
|------|---------|
| `stores/geoEditor.ts` | 选择状态改为 Set，添加多选/批量方法 |
| `components/geo-editor/TimelineTracks.vue` | 修饰键检测、点击逻辑、多选样式 |
| `views/GeoEditor.vue` | 控制栏 UI、页面级键盘事件 |
| `components/map/UniversalMap.vue` | 支持多个高亮区域 |

## UI 设计

### 控制栏布局

```
┌─────────────────────────────────────────────────────────────┐
│ [缩放控件] [已选择 3 个块] [清空] [合并] [时间单位] [折叠] │
└─────────────────────────────────────────────────────────────┘
```

### 按钮状态

- 批量操作按钮组：仅当 `selectedCount > 0` 时显示
- 合并按钮：仅当存在连续选中的块时启用

## 快捷键

| 按键 | 功能 |
|------|------|
| Esc | 取消选择 |
| Delete | 批量清空选中块 |
| Ctrl + 点击 | 添加到选择 |
| Shift + 点击 | 添加到选择 |

## 后续扩展

此功能为后续操作奠定基础：

- **拖动调整**：拖动轨道块边缘扩展/缩小
- **拖动移动**：拖动轨道块到空区域
- **拆分操作**：按指针位置拆分块
- **级联约束**：下级轨道不超出上级范围
