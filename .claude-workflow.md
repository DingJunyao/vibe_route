# Claude 工作流规范

本文档定义了在此项目中与 AI 助手协作时的标准工作流程。

## 工作流原则

### 0. 使用 Skills

开始会话时，使用以下 Skills:

- antfu
- vite
- vue
- vue-best-practices
- vue-router-best-practices 
- vue-testing-best-practices
- pinia
- web-design-guidelines
- remembering-conversations
- verification-before-completion
- frontend-design
- ui-ux-pro-max

### 1. 问题诊断优先级

```
Chrome DevTools MCP 分析
    ↓
添加调试日志
    ↓
用户提供日志/截图
    ↓
分析解决
```

**优先使用 MCP 工具**：
- `chrome-devtools` MCP 获取控制台错误、网络请求、性能分析
- 直接检查数据库状态
- 截图验证前端显示

### 2. 代码修改验证

每次代码修改后必须：
1. **编译通过**: 前端 `npm run build`，后端 Python 语法检查
2. **功能测试**: 运行相关测试
3. **lint 检查**: 项目有 lint 时运行

**不通过不结束任务**。

### 3. 任务完成标准

- [ ] 代码编译通过
- [ ] 相关测试通过
- [ ] 用户验证（如需要）
- [ ] 大任务整理要点到 `CLAUDE.md`

## 开发环境状态

- **前端服务**: 通常已运行 `npm run dev`（热重载）
- **后端服务**: 通常已运行 `uvicorn app.main:app --reload`（热重载）
- **操作原则**: 任务中**不再启动/关闭**已有服务

## 调试工具使用

### Chrome DevTools MCP

当需要调试前端问题时：

1. 确保浏览器以远程调试模式运行。如果没有运行，提示用户执行（以下语句不要自己执行！）：
   ```powershell
   Stop-Process -Name msedge -Force;
   Start-Sleep -Milliseconds 500;
   Start-Process "C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe" -ArgumentList "--remote-debugging-port=9222"
   ```

2. 使用 MCP 工具：
   - `list_console_messages` - 查看控制台日志
   - `list_network_requests` - 查看网络请求
   - `take_screenshot` - 截取页面
   - `get_console_message` - 获取特定消息

3. 日志分析：
   - 搜索 `[标签]` 格式的日志（如 `[AMap]`, `[TrackDetail]`）
   - 优先分析 ERROR 级别
   - 检查网络请求状态码

### 数据库检查

需要时使用 MCP 或直接 SQL 查询验证数据状态。

**重要约束**：
- ✅ 可以：使用 MCP 查询/验证数据状态
- ❌ 禁止：直接修改数据库数据
- ⚠️ 数据显示问题：优先检查前端/后端逻辑，非必要不直接改数据库

**环境要求**：
- Python 使用 Anaconda 环境 `vibe_route`
- 所有 Python 操作必须先 `conda activate vibe_route`

## 文档更新规范

### CLAUDE.md 维护

- **大小限制**: < 40KB
- **压缩策略**: 详细内容移至 `ref/CLAUDE_ARCHIVE.md`
- **更新时机**: 大功能完成后
- **格式**: 简洁表格 + 关键代码片段

### 代码注释

- 与现有代码保持一致的语言风格
- 复杂逻辑添加解释注释
- 不注释显而易见的代码

- 与现有代码保持一致的语言风格
- 复杂逻辑添加解释注释
- 不注释显而易见的代码

## 常用命令

```bash
# 后端
cd backend && uvicorn app.main:app --reload

# 前端
cd frontend && npm run dev

# 数据库迁移
cd backend && alembic upgrade head

# Python 环境（Anaconda）
conda activate vibe_route
```

## 应急流程

### 编译失败
1. 检查语法错误
2. 检查导入依赖
3. 检查类型定义
4. 逐个修复直到通过

### 测试失败
1. 分析失败原因
2. 添加调试日志
3. 修复代码
4. 重新测试

### 无法定位问题
1. 使用 Chrome DevTools 深入分析
2. 添加详细日志重现
3. 最小化复现步骤
4. 向用户提供复现路径
